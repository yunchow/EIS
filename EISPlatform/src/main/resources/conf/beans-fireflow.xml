<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context"
	xmlns:tx="http://www.springframework.org/schema/tx" xmlns:aop="http://www.springframework.org/schema/aop"
	xsi:schemaLocation="http://www.springframework.org/schema/beans 
						http://www.springframework.org/schema/beans/spring-beans.xsd
						http://www.springframework.org/schema/tx 
						http://www.springframework.org/schema/tx/spring-tx.xsd
						http://www.springframework.org/schema/aop
						http://www.springframework.org/schema/aop/spring-aop.xsd
						http://www.springframework.org/schema/context 
						http://www.springframework.org/schema/context/spring-context.xsd">

	<bean id="runtimeContext" class="org.fireflow.engine.RuntimeContext" init-method="initialize">
		<property name="taskInstanceManager" ref="taskInstanceManager" />
		<property name="definitionService" ref="definitionService" />
		<property name="persistenceService" ref="fireflowPersistenceImpl" />
		<property name="conditionResolver" ref="conditionResolver" />
		<property name="calendarService" ref="calendarService" />
		<property name="kenelManager" ref="kenelManager" />
	</bean>

	<bean id="taskInstanceManager" class="org.fireflow.engine.taskinstance.BasicTaskInstanceManager"></bean>

	<!-- **************workflow Definitions Begin******* -->
	<bean id="definitionService" class="org.fireflow.engine.definition.DefinitionService4FileSystem">
		<property name="definitionFiles">
			<list>
				<value>classpath*:conf/workflow/*.xml</value>
			</list>
		</property>
	</bean>
	<!-- **************workflow Definitions End******* -->


	<!-- **************CalendarService Begin******************** -->
	<bean id="calendarService" class="org.fireflow.engine.calendar.DefaultCalendarService">
	</bean>
	<!-- ***************CalendarService End******************* -->


	<bean id="conditionResolver" class="org.fireflow.engine.condition.ConditionResolver">
	</bean>

	<!-- **************Kenel Manager Begin*************** -->
	<bean id="kenelManager" class="org.fireflow.kenel.KenelManager">
		<property name="kenelExtensions">
			<map>
				<entry key="org.fireflow.kenel.StartNodeInstance">
					<list>
						<ref local="startNodeInstanceEventListenser" />
					</list>
				</entry>
				<entry key="org.fireflow.kenel.ActivityInstance">
					<list>
						<ref local="activityInstanceEventListener" />
					</list>
				</entry>
				<entry key="org.fireflow.kenel.SynchronizerInstance">
					<list>
						<ref local="synchronizerInstanceEventListenser" />
					</list>
				</entry>
				<entry key="org.fireflow.kenel.EndNodeInstance">
					<list>
						<ref local="endNodeInstanceEventListenser" />
					</list>
				</entry>
				<entry key="org.fireflow.kenel.TransitionInstance">
					<list>
						<ref local="transitionInstanceEventListenser" />
					</list>
				</entry>
			</map>
		</property>
	</bean>
	<!-- **************Kenel Manager End*************** -->

	<!-- kenel extensions (begin) -->
	<bean id="startNodeInstanceEventListenser"
		class="org.fireflow.engine.kenelextensions.StartNodeInstanceExtension">
	</bean>
	<bean id="activityInstanceEventListener"
		class="org.fireflow.engine.kenelextensions.ActivityInstanceExtension">
	</bean>
	<bean id="synchronizerInstanceEventListenser"
		class="org.fireflow.engine.kenelextensions.SynchronizerInstanceExtension">
	</bean>
	<bean id="endNodeInstanceEventListenser"
		class="org.fireflow.engine.kenelextensions.EndNodeInstanceExtension">
	</bean>
	<bean id="transitionInstanceEventListenser"
		class="org.fireflow.engine.kenelextensions.TransitionInstanceExtension">
	</bean>
	<!-- kenel extensions (end) -->

</beans>
